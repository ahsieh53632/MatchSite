{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"D:\\\\MatchSite\\\\src\\\\pages\\\\ChatPage\\\\chatRoom.js\";\nimport React, { useEffect, Component } from 'react';\nimport socketIOClient from \"socket.io-client\";\nimport ChatRoomHeader from './chatRoomHeader';\nimport { makeStyles } from '@material-ui/styles';\nimport MessageList from './MessageList';\nimport CssBaseline from '@material-ui/core/CssBaseline';\nvar ENDPOINT = \"https://matchsitebackend.herokuapp.com/\";\nvar APILINK = 'https://matchsitebackend.herokuapp.com/msg/get';\n\nfunction mysqlTimeStampToDate(timestamp) {\n  var regex = /^([0-9]{2,4})-([0-1][0-9])-([0-3][0-9])T(?:([0-2][0-9]):([0-5][0-9]):([0-5][0-9])).000Z?$/;\n  var parts = timestamp.replace(regex, \"$1 $2 $3 $4 $5 $6\").split(' ');\n  return new Date(parts[0], parts[1] - 1, parts[2], parts[3], parts[4], parts[5]);\n}\n\nvar ChatRoom = function ChatRoom(props) {\n  var _ref = props || {\n    user: \"\",\n    to: \"\"\n  },\n      user = _ref.user,\n      to = _ref.to,\n      phone = _ref.phone;\n\n  var _React$useState = React.useState([]),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      msgs = _React$useState2[0],\n      setMsgs = _React$useState2[1];\n\n  var _onSend = function onSend(msg) {\n    if (typeof window !== 'undefined') {\n      fetch('https://matchsitebackend.herokuapp.com/msg/post', {\n        method: 'PUT',\n        headers: {\n          'Accept': 'application/json',\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          \"account\": user,\n          \"to\": to,\n          \"msg\": msg\n        })\n      }).then(function (res) {\n        return res.json();\n      }).then(function (data) {\n        if (data.success) {\n          console.log('successfully added to db');\n        } else {\n          console.log('ERROR');\n        }\n      });\n    }\n\n    setMsgs([].concat(_toConsumableArray(msgs), [{\n      id: new Date().toLocaleDateString(),\n      author: user,\n      message: msg,\n      timestamp: require('moment')().format(\"YYYY-MM-DD HH:mm:ss\")\n    }]));\n  };\n\n  useEffect(function () {\n    var socket = socketIOClient(ENDPOINT);\n    socket.emit('join', user);\n    socket.on('message', function (msg) {\n      setMsgs([].concat(_toConsumableArray(msgs), [msg]));\n    });\n\n    if (typeof window !== 'undefined') {\n      fetch('https://matchsitebackend.herokuapp.com/msg/get', {\n        method: 'POST',\n        headers: {\n          'Accept': 'application/json',\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          \"account\": user,\n          \"to\": to\n        })\n      }).then(function (res) {\n        return res.json();\n      }).then(function (data) {\n        if (data.success) {\n          var fetchedMsgs = data.data.map(function (row, i) {\n            return {\n              id: i,\n              author: row.userName,\n              message: row.msg,\n              timestamp: mysqlTimeStampToDate(row.time)\n            };\n          });\n          console.log(fetchedMsgs);\n          setMsgs(fetchedMsgs);\n        } else {\n          console.log('ERROR');\n        }\n      });\n    }\n\n    return function () {\n      return socket.disconnect();\n    };\n  }, []);\n  return React.createElement(React.Fragment, null, React.createElement(CssBaseline, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 13\n    }\n  }), React.createElement(ChatRoomHeader, {\n    userName: user,\n    phone: phone,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 13\n    }\n  }), React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 13\n    }\n  }, React.createElement(MessageList, {\n    user: user,\n    messages: msgs,\n    onSend: function onSend(message) {\n      return _onSend(message);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 17\n    }\n  })));\n};\n\nexport default ChatRoom;","map":{"version":3,"sources":["D:/MatchSite/src/pages/ChatPage/chatRoom.js"],"names":["React","useEffect","Component","socketIOClient","ChatRoomHeader","makeStyles","MessageList","CssBaseline","ENDPOINT","APILINK","mysqlTimeStampToDate","timestamp","regex","parts","replace","split","Date","ChatRoom","props","user","to","phone","useState","msgs","setMsgs","onSend","msg","window","fetch","method","headers","body","JSON","stringify","then","res","json","data","success","console","log","id","toLocaleDateString","author","message","require","format","socket","emit","on","fetchedMsgs","map","row","i","userName","time","disconnect"],"mappings":";;;AAAA,OAAOA,KAAP,IAAeC,SAAf,EAA0BC,SAA1B,QAA2C,OAA3C;AACA,OAAOC,cAAP,MAA2B,kBAA3B;AACA,OAAOC,cAAP,MAA2B,kBAA3B;AACA,SAASC,UAAT,QAA2B,qBAA3B;AACA,OAAOC,WAAP,MAAwB,eAAxB;AACA,OAAOC,WAAP,MAAwB,+BAAxB;AAGA,IAAMC,QAAQ,GAAG,yCAAjB;AACA,IAAMC,OAAO,GAAG,gDAAhB;;AAGA,SAASC,oBAAT,CAA8BC,SAA9B,EAAyC;AAGrC,MAAIC,KAAK,GAAC,2FAAV;AACA,MAAIC,KAAK,GAACF,SAAS,CAACG,OAAV,CAAkBF,KAAlB,EAAwB,mBAAxB,EAA6CG,KAA7C,CAAmD,GAAnD,CAAV;AACA,SAAO,IAAIC,IAAJ,CAASH,KAAK,CAAC,CAAD,CAAd,EAAkBA,KAAK,CAAC,CAAD,CAAL,GAAS,CAA3B,EAA6BA,KAAK,CAAC,CAAD,CAAlC,EAAsCA,KAAK,CAAC,CAAD,CAA3C,EAA+CA,KAAK,CAAC,CAAD,CAApD,EAAwDA,KAAK,CAAC,CAAD,CAA7D,CAAP;AACH;;AAED,IAAMI,QAAQ,GAAG,SAAXA,QAAW,CAACC,KAAD,EAAW;AAAA,aACEA,KAAK,IAAI;AAACC,IAAAA,IAAI,EAAE,EAAP;AAAWC,IAAAA,EAAE,EAAE;AAAf,GADX;AAAA,MACjBD,IADiB,QACjBA,IADiB;AAAA,MACXC,EADW,QACXA,EADW;AAAA,MACPC,KADO,QACPA,KADO;;AAAA,wBAEArB,KAAK,CAACsB,QAAN,CAAe,EAAf,CAFA;AAAA;AAAA,MAEjBC,IAFiB;AAAA,MAEXC,OAFW;;AAIxB,MAAMC,OAAM,GAAG,SAATA,MAAS,CAACC,GAAD,EAAS;AAEpB,QAAI,OAAOC,MAAP,KAAkB,WAAtB,EAAmC;AAC/BC,MAAAA,KAAK,CAAC,iDAAD,EAAoD;AACrDC,QAAAA,MAAM,EAAE,KAD6C;AAErDC,QAAAA,OAAO,EAAE;AACL,oBAAU,kBADL;AAEL,0BAAgB;AAFX,SAF4C;AAMrDC,QAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAe;AACjB,qBAAWd,IADM;AAEjB,gBAAMC,EAFW;AAGjB,iBAAOM;AAHU,SAAf;AAN+C,OAApD,CAAL,CAYKQ,IAZL,CAYU,UAAAC,GAAG;AAAA,eAAIA,GAAG,CAACC,IAAJ,EAAJ;AAAA,OAZb,EAaKF,IAbL,CAaU,UAAAG,IAAI,EAAI;AACV,YAAIA,IAAI,CAACC,OAAT,EAAkB;AACdC,UAAAA,OAAO,CAACC,GAAR,CAAY,0BAAZ;AACH,SAFD,MAEO;AACHD,UAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ;AACH;AACJ,OAnBL;AAoBH;;AACDhB,IAAAA,OAAO,8BAAKD,IAAL,IAAW;AACdkB,MAAAA,EAAE,EAAE,IAAIzB,IAAJ,GAAW0B,kBAAX,EADU;AAEdC,MAAAA,MAAM,EAAExB,IAFM;AAGdyB,MAAAA,OAAO,EAAElB,GAHK;AAIdf,MAAAA,SAAS,EAAEkC,OAAO,CAAC,QAAD,CAAP,GAAoBC,MAApB,CAA2B,qBAA3B;AAJG,KAAX,GAAP;AAMH,GA9BD;;AAgCA7C,EAAAA,SAAS,CAAC,YAAM;AACZ,QAAM8C,MAAM,GAAG5C,cAAc,CAACK,QAAD,CAA7B;AACAuC,IAAAA,MAAM,CAACC,IAAP,CAAY,MAAZ,EAAoB7B,IAApB;AACA4B,IAAAA,MAAM,CAACE,EAAP,CAAU,SAAV,EAAqB,UAAAvB,GAAG,EAAI;AAACF,MAAAA,OAAO,8BAAKD,IAAL,IAAWG,GAAX,GAAP;AAAwB,KAArD;;AACA,QAAI,OAAOC,MAAP,KAAkB,WAAtB,EAAmC;AAC/BC,MAAAA,KAAK,CAAC,gDAAD,EAAmD;AACpDC,QAAAA,MAAM,EAAE,MAD4C;AAEpDC,QAAAA,OAAO,EAAE;AACL,oBAAU,kBADL;AAEL,0BAAgB;AAFX,SAF2C;AAMpDC,QAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAe;AACjB,qBAAWd,IADM;AAEjB,gBAAMC;AAFW,SAAf;AAN8C,OAAnD,CAAL,CAWKc,IAXL,CAWU,UAAAC,GAAG;AAAA,eAAIA,GAAG,CAACC,IAAJ,EAAJ;AAAA,OAXb,EAYKF,IAZL,CAYU,UAAAG,IAAI,EAAI;AACV,YAAIA,IAAI,CAACC,OAAT,EAAkB;AACd,cAAMY,WAAW,GAAGb,IAAI,CAACA,IAAL,CAAUc,GAAV,CAAc,UAACC,GAAD,EAAMC,CAAN,EAAY;AAC1C,mBAAO;AACHZ,cAAAA,EAAE,EAAEY,CADD;AAEHV,cAAAA,MAAM,EAAES,GAAG,CAACE,QAFT;AAGHV,cAAAA,OAAO,EAAEQ,GAAG,CAAC1B,GAHV;AAIHf,cAAAA,SAAS,EAAED,oBAAoB,CAAC0C,GAAG,CAACG,IAAL;AAJ5B,aAAP;AAMH,WAPmB,CAApB;AAQAhB,UAAAA,OAAO,CAACC,GAAR,CAAYU,WAAZ;AACA1B,UAAAA,OAAO,CAAC0B,WAAD,CAAP;AACH,SAXD,MAWO;AACLX,UAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ;AACD;AAAC,OA1BV;AA2BH;;AACD,WAAO;AAAA,aAAMO,MAAM,CAACS,UAAP,EAAN;AAAA,KAAP;AACH,GAlCQ,EAkCN,EAlCM,CAAT;AAoCA,SACI,0CACI,oBAAC,WAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADJ,EAEI,oBAAC,cAAD;AAAgB,IAAA,QAAQ,EAAErC,IAA1B;AAAgC,IAAA,KAAK,EAAEE,KAAvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAFJ,EAGI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACI,oBAAC,WAAD;AAAa,IAAA,IAAI,EAAEF,IAAnB;AAAyB,IAAA,QAAQ,EAAEI,IAAnC;AAAyC,IAAA,MAAM,EAAE,gBAACqB,OAAD;AAAA,aAAanB,OAAM,CAACmB,OAAD,CAAnB;AAAA,KAAjD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADJ,CAHJ,CADJ;AAWH,CAnFD;;AAqFA,eAAe3B,QAAf","sourcesContent":["import React, {useEffect, Component } from 'react';\r\nimport socketIOClient from \"socket.io-client\";\r\nimport ChatRoomHeader from './chatRoomHeader';\r\nimport { makeStyles } from '@material-ui/styles'\r\nimport MessageList from './MessageList'\r\nimport CssBaseline from '@material-ui/core/CssBaseline'\r\n\r\n\r\nconst ENDPOINT = \"https://matchsitebackend.herokuapp.com/\"\r\nconst APILINK = 'https://matchsitebackend.herokuapp.com/msg/get';\r\n\r\n\r\nfunction mysqlTimeStampToDate(timestamp) {\r\n    //function parses mysql datetime string and returns javascript Date object\r\n    //input has to be in this format: 2007-06-05 15:26:02\r\n    var regex=/^([0-9]{2,4})-([0-1][0-9])-([0-3][0-9])T(?:([0-2][0-9]):([0-5][0-9]):([0-5][0-9])).000Z?$/;\r\n    var parts=timestamp.replace(regex,\"$1 $2 $3 $4 $5 $6\").split(' ');\r\n    return new Date(parts[0],parts[1]-1,parts[2],parts[3],parts[4],parts[5]);\r\n}\r\n\r\nconst ChatRoom = (props) => {\r\n    const {user, to, phone} = props || {user: \"\", to: \"\"};\r\n    const [msgs, setMsgs] = React.useState([]);\r\n\r\n    const onSend = (msg) => {\r\n\r\n        if (typeof window !== 'undefined') {\r\n            fetch('https://matchsitebackend.herokuapp.com/msg/post', {\r\n                method: 'PUT',\r\n                headers: {\r\n                    'Accept': 'application/json',\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify({\r\n                    \"account\": user,\r\n                    \"to\": to,\r\n                    \"msg\": msg,\r\n                })\r\n                })\r\n                .then(res => res.json())\r\n                .then(data => {\r\n                    if (data.success) {\r\n                        console.log('successfully added to db')\r\n                    } else {\r\n                        console.log('ERROR')\r\n                    }\r\n                })\r\n        }\r\n        setMsgs([...msgs, {\r\n            id: new Date().toLocaleDateString(),\r\n            author: user,\r\n            message: msg,\r\n            timestamp: require('moment')().format(\"YYYY-MM-DD HH:mm:ss\")\r\n        }])\r\n    }\r\n    \r\n    useEffect(() => {\r\n        const socket = socketIOClient(ENDPOINT);\r\n        socket.emit('join', user);\r\n        socket.on('message', msg => {setMsgs([...msgs, msg])});\r\n        if (typeof window !== 'undefined') {\r\n            fetch('https://matchsitebackend.herokuapp.com/msg/get', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Accept': 'application/json',\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify({\r\n                    \"account\": user,\r\n                    \"to\": to,\r\n                })\r\n                })\r\n                .then(res => res.json())\r\n                .then(data => {\r\n                    if (data.success) {\r\n                        const fetchedMsgs = data.data.map((row, i) => {\r\n                            return {\r\n                                id: i,\r\n                                author: row.userName,\r\n                                message: row.msg,\r\n                                timestamp: mysqlTimeStampToDate(row.time)\r\n                            }\r\n                        })\r\n                        console.log(fetchedMsgs);\r\n                        setMsgs(fetchedMsgs);\r\n                    } else {\r\n                      console.log('ERROR')\r\n                    }})\r\n        }\r\n        return () => socket.disconnect();\r\n    }, [])\r\n\r\n    return (\r\n        <>\r\n            <CssBaseline />\r\n            <ChatRoomHeader userName={user} phone={phone}/>\r\n            <div>\r\n                <MessageList user={user} messages={msgs} onSend={(message) => onSend(message)}/>\r\n            </div>\r\n        </>\r\n        )\r\n\r\n\r\n}\r\n\r\nexport default ChatRoom;"]},"metadata":{},"sourceType":"module"}