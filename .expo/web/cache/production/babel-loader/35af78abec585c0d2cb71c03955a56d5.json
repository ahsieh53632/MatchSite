{"ast":null,"code":"import _get from\"@babel/runtime/helpers/get\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";import _toConsumableArray from\"@babel/runtime/helpers/toConsumableArray\";import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import _extends from\"@babel/runtime/helpers/extends\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import prefetchHelper from\"./prefetch\";import emitter from\"./emitter\";import{setMatchPaths,findPath,findMatchPath as _findMatchPath}from\"./find-path\";export var PageResourceStatus={Error:\"error\",Success:\"success\"};var preferDefault=function preferDefault(m){return m&&m.default||m;};var stripSurroundingSlashes=function stripSurroundingSlashes(s){s=s[0]===\"/\"?s.slice(1):s;s=s.endsWith(\"/\")?s.slice(0,-1):s;return s;};var createPageDataUrl=function createPageDataUrl(path){var fixedPath=path===\"/\"?\"index\":stripSurroundingSlashes(path);return __PATH_PREFIX__+\"/page-data/\"+fixedPath+\"/page-data.json\";};function doFetch(url){var method=arguments.length>1&&arguments[1]!==undefined?arguments[1]:\"GET\";return new Promise(function(resolve,reject){var req=new XMLHttpRequest();req.open(method,url,true);req.onreadystatechange=function(){if(req.readyState==4){resolve(req);}};req.send(null);});}var doesConnectionSupportPrefetch=function doesConnectionSupportPrefetch(){if(\"connection\"in navigator&&typeof navigator.connection!==\"undefined\"){if((navigator.connection.effectiveType||\"\").includes(\"2g\")){return false;}if(navigator.connection.saveData){return false;}}return true;};var toPageResources=function toPageResources(pageData){var component=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var page={componentChunkName:pageData.componentChunkName,path:pageData.path,webpackCompilationHash:pageData.webpackCompilationHash,matchPath:pageData.matchPath,staticQueryHashes:pageData.staticQueryHashes};return{component:component,json:pageData.result,page:page};};export var BaseLoader=function(){function BaseLoader(loadComponent,matchPaths){_classCallCheck(this,BaseLoader);this.inFlightNetworkRequests=new Map();this.pageDb=new Map();this.inFlightDb=new Map();this.staticQueryDb=new Map();this.pageDataDb=new Map();this.prefetchTriggered=new Set();this.prefetchCompleted=new Set();this.loadComponent=loadComponent;setMatchPaths(matchPaths);}_createClass(BaseLoader,[{key:\"memoizedGet\",value:function memoizedGet(url){var _this=this;var inFlightPromise=this.inFlightNetworkRequests.get(url);if(!inFlightPromise){inFlightPromise=doFetch(url,\"GET\");this.inFlightNetworkRequests.set(url,inFlightPromise);}return inFlightPromise.then(function(response){_this.inFlightNetworkRequests.delete(url);return response;}).catch(function(err){_this.inFlightNetworkRequests.delete(url);throw err;});}},{key:\"setApiRunner\",value:function setApiRunner(apiRunner){this.apiRunner=apiRunner;this.prefetchDisabled=apiRunner(\"disableCorePrefetching\").some(function(a){return a;});}},{key:\"fetchPageDataJson\",value:function fetchPageDataJson(loadObj){var _this2=this;var pagePath=loadObj.pagePath,_loadObj$retries=loadObj.retries,retries=_loadObj$retries===void 0?0:_loadObj$retries;var url=createPageDataUrl(pagePath);return this.memoizedGet(url).then(function(req){var status=req.status,responseText=req.responseText;if(status===200){try{var jsonPayload=JSON.parse(responseText);if(jsonPayload.path===undefined){throw new Error(\"not a valid pageData response\");}return _extends(loadObj,{status:PageResourceStatus.Success,payload:jsonPayload});}catch(err){}}if(status===404||status===200){if(pagePath===\"/404.html\"){return _extends(loadObj,{status:PageResourceStatus.Error});}return _this2.fetchPageDataJson(_extends(loadObj,{pagePath:\"/404.html\",notFound:true}));}if(status===500){return _extends(loadObj,{status:PageResourceStatus.Error});}if(retries<3){return _this2.fetchPageDataJson(_extends(loadObj,{retries:retries+1}));}return _extends(loadObj,{status:PageResourceStatus.Error});});}},{key:\"loadPageDataJson\",value:function loadPageDataJson(rawPath){var _this3=this;var pagePath=findPath(rawPath);if(this.pageDataDb.has(pagePath)){return Promise.resolve(this.pageDataDb.get(pagePath));}return this.fetchPageDataJson({pagePath:pagePath}).then(function(pageData){_this3.pageDataDb.set(pagePath,pageData);return pageData;});}},{key:\"findMatchPath\",value:function findMatchPath(rawPath){return _findMatchPath(rawPath);}},{key:\"loadPage\",value:function loadPage(rawPath){var _this4=this;var pagePath=findPath(rawPath);if(this.pageDb.has(pagePath)){var page=this.pageDb.get(pagePath);return Promise.resolve(page.payload);}if(this.inFlightDb.has(pagePath)){return this.inFlightDb.get(pagePath);}var inFlightPromise=Promise.all([this.loadAppData(),this.loadPageDataJson(pagePath)]).then(function(allData){var result=allData[1];if(result.status===PageResourceStatus.Error){return{status:PageResourceStatus.Error};}var pageData=result.payload;var _pageData=pageData,componentChunkName=_pageData.componentChunkName,_pageData$staticQuery=_pageData.staticQueryHashes,staticQueryHashes=_pageData$staticQuery===void 0?[]:_pageData$staticQuery;var finalResult={};var componentChunkPromise=_this4.loadComponent(componentChunkName).then(function(component){finalResult.createdAt=new Date();var pageResources;if(!component){finalResult.status=PageResourceStatus.Error;}else{finalResult.status=PageResourceStatus.Success;if(result.notFound===true){finalResult.notFound=true;}pageData=_extends(pageData,{webpackCompilationHash:allData[0]?allData[0].webpackCompilationHash:\"\"});pageResources=toPageResources(pageData,component);}return pageResources;});var staticQueryBatchPromise=Promise.all(staticQueryHashes.map(function(staticQueryHash){if(_this4.staticQueryDb.has(staticQueryHash)){var jsonPayload=_this4.staticQueryDb.get(staticQueryHash);return{staticQueryHash:staticQueryHash,jsonPayload:jsonPayload};}return _this4.memoizedGet(__PATH_PREFIX__+\"/static/d/\"+staticQueryHash+\".json\").then(function(req){var jsonPayload=JSON.parse(req.responseText);return{staticQueryHash:staticQueryHash,jsonPayload:jsonPayload};});})).then(function(staticQueryResults){var staticQueryResultsMap={};staticQueryResults.forEach(function(_ref){var staticQueryHash=_ref.staticQueryHash,jsonPayload=_ref.jsonPayload;staticQueryResultsMap[staticQueryHash]=jsonPayload;_this4.staticQueryDb.set(staticQueryHash,jsonPayload);});return staticQueryResultsMap;});return Promise.all([componentChunkPromise,staticQueryBatchPromise]).then(function(_ref2){var _ref3=_slicedToArray(_ref2,2),pageResources=_ref3[0],staticQueryResults=_ref3[1];var payload;if(pageResources){payload=_objectSpread(_objectSpread({},pageResources),{},{staticQueryResults:staticQueryResults});finalResult.payload=payload;emitter.emit(\"onPostLoadPageResources\",{page:payload,pageResources:payload});}_this4.pageDb.set(pagePath,finalResult);return payload;});});inFlightPromise.then(function(response){_this4.inFlightDb.delete(pagePath);}).catch(function(error){_this4.inFlightDb.delete(pagePath);throw error;});this.inFlightDb.set(pagePath,inFlightPromise);return inFlightPromise;}},{key:\"loadPageSync\",value:function loadPageSync(rawPath){var pagePath=findPath(rawPath);if(this.pageDb.has(pagePath)){var pageData=this.pageDb.get(pagePath).payload;return pageData;}return undefined;}},{key:\"shouldPrefetch\",value:function shouldPrefetch(pagePath){if(!doesConnectionSupportPrefetch()){return false;}if(this.pageDb.has(pagePath)){return false;}return true;}},{key:\"prefetch\",value:function prefetch(pagePath){var _this5=this;if(!this.shouldPrefetch(pagePath)){return false;}if(!this.prefetchTriggered.has(pagePath)){this.apiRunner(\"onPrefetchPathname\",{pathname:pagePath});this.prefetchTriggered.add(pagePath);}if(this.prefetchDisabled){return false;}var realPath=findPath(pagePath);this.doPrefetch(realPath).then(function(){if(!_this5.prefetchCompleted.has(pagePath)){_this5.apiRunner(\"onPostPrefetchPathname\",{pathname:pagePath});_this5.prefetchCompleted.add(pagePath);}});return true;}},{key:\"doPrefetch\",value:function doPrefetch(pagePath){throw new Error(\"doPrefetch not implemented\");}},{key:\"hovering\",value:function hovering(rawPath){this.loadPage(rawPath);}},{key:\"getResourceURLsForPathname\",value:function getResourceURLsForPathname(rawPath){var pagePath=findPath(rawPath);var page=this.pageDataDb.get(pagePath);if(page){var pageResources=toPageResources(page.payload);return[].concat(_toConsumableArray(createComponentUrls(pageResources.page.componentChunkName)),[createPageDataUrl(pagePath)]);}else{return null;}}},{key:\"isPageNotFound\",value:function isPageNotFound(rawPath){var pagePath=findPath(rawPath);var page=this.pageDb.get(pagePath);return page&&page.notFound===true;}},{key:\"loadAppData\",value:function loadAppData(){var _this6=this;var retries=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;return this.memoizedGet(__PATH_PREFIX__+\"/page-data/app-data.json\").then(function(req){var status=req.status,responseText=req.responseText;var appData;if(status!==200&&retries<3){return _this6.loadAppData(retries+1);}if(status===200){try{var jsonPayload=JSON.parse(responseText);if(jsonPayload.webpackCompilationHash===undefined){throw new Error(\"not a valid app-data response\");}appData=jsonPayload;}catch(err){}}return appData;});}}]);return BaseLoader;}();var createComponentUrls=function createComponentUrls(componentChunkName){return(window.___chunkMapping[componentChunkName]||[]).map(function(chunk){return __PATH_PREFIX__+chunk;});};export var ProdLoader=function(_BaseLoader){_inherits(ProdLoader,_BaseLoader);var _super=_createSuper(ProdLoader);function ProdLoader(asyncRequires,matchPaths){_classCallCheck(this,ProdLoader);var loadComponent=function loadComponent(chunkName){return asyncRequires.components[chunkName]?asyncRequires.components[chunkName]().then(preferDefault).catch(function(){return null;}):Promise.resolve();};return _super.call(this,loadComponent,matchPaths);}_createClass(ProdLoader,[{key:\"doPrefetch\",value:function doPrefetch(pagePath){var _this7=this;var pageDataUrl=createPageDataUrl(pagePath);return prefetchHelper(pageDataUrl,{crossOrigin:\"anonymous\",as:\"fetch\"}).then(function(){return _this7.loadPageDataJson(pagePath);}).then(function(result){if(result.status!==PageResourceStatus.Success){return Promise.resolve();}var pageData=result.payload;var chunkName=pageData.componentChunkName;var componentUrls=createComponentUrls(chunkName);return Promise.all(componentUrls.map(prefetchHelper)).then(function(){return pageData;});});}},{key:\"loadPageDataJson\",value:function loadPageDataJson(rawPath){return _get(_getPrototypeOf(ProdLoader.prototype),\"loadPageDataJson\",this).call(this,rawPath).then(function(data){if(data.notFound){return doFetch(rawPath,\"HEAD\").then(function(req){if(req.status===200){return{status:PageResourceStatus.Error};}return data;});}return data;});}}]);return ProdLoader;}(BaseLoader);var instance;export var setLoader=function setLoader(_loader){instance=_loader;};export var publicLoader={getResourcesForPathname:function getResourcesForPathname(rawPath){console.warn(\"Warning: getResourcesForPathname is deprecated. Use loadPage instead\");return instance.i.loadPage(rawPath);},getResourcesForPathnameSync:function getResourcesForPathnameSync(rawPath){console.warn(\"Warning: getResourcesForPathnameSync is deprecated. Use loadPageSync instead\");return instance.i.loadPageSync(rawPath);},enqueue:function enqueue(rawPath){return instance.prefetch(rawPath);},getResourceURLsForPathname:function getResourceURLsForPathname(rawPath){return instance.getResourceURLsForPathname(rawPath);},loadPage:function loadPage(rawPath){return instance.loadPage(rawPath);},loadPageSync:function loadPageSync(rawPath){return instance.loadPageSync(rawPath);},prefetch:function prefetch(rawPath){return instance.prefetch(rawPath);},isPageNotFound:function isPageNotFound(rawPath){return instance.isPageNotFound(rawPath);},hovering:function hovering(rawPath){return instance.hovering(rawPath);},loadAppData:function loadAppData(){return instance.loadAppData();}};export default publicLoader;","map":{"version":3,"sources":["D:/MatchSite/.cache/loader.js"],"names":["prefetchHelper","emitter","setMatchPaths","findPath","findMatchPath","PageResourceStatus","Error","Success","preferDefault","m","default","stripSurroundingSlashes","s","slice","endsWith","createPageDataUrl","path","fixedPath","__PATH_PREFIX__","doFetch","url","method","Promise","resolve","reject","req","XMLHttpRequest","open","onreadystatechange","readyState","send","doesConnectionSupportPrefetch","navigator","connection","effectiveType","includes","saveData","toPageResources","pageData","component","page","componentChunkName","webpackCompilationHash","matchPath","staticQueryHashes","json","result","BaseLoader","loadComponent","matchPaths","inFlightNetworkRequests","Map","pageDb","inFlightDb","staticQueryDb","pageDataDb","prefetchTriggered","Set","prefetchCompleted","inFlightPromise","get","set","then","response","delete","catch","err","apiRunner","prefetchDisabled","some","a","loadObj","pagePath","retries","memoizedGet","status","responseText","jsonPayload","JSON","parse","undefined","payload","fetchPageDataJson","notFound","rawPath","has","all","loadAppData","loadPageDataJson","allData","finalResult","componentChunkPromise","createdAt","Date","pageResources","staticQueryBatchPromise","map","staticQueryHash","staticQueryResults","staticQueryResultsMap","forEach","emit","error","shouldPrefetch","pathname","add","realPath","doPrefetch","loadPage","createComponentUrls","appData","window","___chunkMapping","chunk","ProdLoader","asyncRequires","chunkName","components","pageDataUrl","crossOrigin","as","componentUrls","data","instance","setLoader","_loader","publicLoader","getResourcesForPathname","console","warn","i","getResourcesForPathnameSync","loadPageSync","enqueue","prefetch","getResourceURLsForPathname","isPageNotFound","hovering"],"mappings":"2kEAAA,MAAOA,CAAAA,cAAP,KAA2B,YAA3B,CACA,MAAOC,CAAAA,OAAP,KAAoB,WAApB,CACA,OAASC,aAAT,CAAwBC,QAAxB,CAAkCC,aAAa,GAAbA,CAAAA,cAAlC,KAAuD,aAAvD,CAKA,MAAO,IAAMC,CAAAA,kBAAkB,CAAG,CAIhCC,KAAK,QAJ2B,CAQhCC,OAAO,UARyB,CAA3B,CAWP,GAAMC,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAAAC,CAAC,QAAKA,CAAAA,CAAC,EAAIA,CAAC,CAACC,OAAR,EAAoBD,CAAxB,EAAvB,CAEA,GAAME,CAAAA,uBAAuB,CAAG,QAA1BA,CAAAA,uBAA0B,CAAAC,CAAC,CAAI,CACnCA,CAAC,CAAGA,CAAC,CAAC,CAAD,CAAD,OAAeA,CAAC,CAACC,KAAF,CAAQ,CAAR,CAAf,CAA4BD,CAAhC,CACAA,CAAC,CAAGA,CAAC,CAACE,QAAF,MAAkBF,CAAC,CAACC,KAAF,CAAQ,CAAR,CAAW,CAAC,CAAZ,CAAlB,CAAmCD,CAAvC,CACA,MAAOA,CAAAA,CAAP,CACD,CAJD,CAMA,GAAMG,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAAAC,IAAI,CAAI,CAChC,GAAMC,CAAAA,SAAS,CAAGD,IAAI,MAAJ,SAAyBL,uBAAuB,CAACK,IAAD,CAAlE,CACA,MAAUE,CAAAA,eAAV,eAAuCD,SAAvC,mBACD,CAHD,CAKA,QAASE,CAAAA,OAAT,CAAiBC,GAAjB,CAAsC,IAAhBC,CAAAA,MAAgB,iEACpC,MAAO,IAAIC,CAAAA,OAAJ,CAAY,SAACC,OAAD,CAAUC,MAAV,CAAqB,CACtC,GAAMC,CAAAA,GAAG,CAAG,GAAIC,CAAAA,cAAJ,EAAZ,CACAD,GAAG,CAACE,IAAJ,CAASN,MAAT,CAAiBD,GAAjB,CAAsB,IAAtB,EACAK,GAAG,CAACG,kBAAJ,CAAyB,UAAM,CAC7B,GAAIH,GAAG,CAACI,UAAJ,EAAkB,CAAtB,CAAyB,CACvBN,OAAO,CAACE,GAAD,CAAP,CACD,CACF,CAJD,CAKAA,GAAG,CAACK,IAAJ,CAAS,IAAT,EACD,CATM,CAAP,CAUD,CAED,GAAMC,CAAAA,6BAA6B,CAAG,QAAhCA,CAAAA,6BAAgC,EAAM,CAC1C,GACE,cAAgBC,CAAAA,SAAhB,EACA,MAAOA,CAAAA,SAAS,CAACC,UAAjB,cAFF,CAGE,CACA,GAAI,CAACD,SAAS,CAACC,UAAV,CAAqBC,aAArB,IAAD,EAA2CC,QAA3C,MAAJ,CAA+D,CAC7D,MAAO,MAAP,CACD,CACD,GAAIH,SAAS,CAACC,UAAV,CAAqBG,QAAzB,CAAmC,CACjC,MAAO,MAAP,CACD,CACF,CACD,MAAO,KAAP,CACD,CAbD,CAeA,GAAMC,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAACC,QAAD,CAAgC,IAArBC,CAAAA,SAAqB,2DAAT,IAAS,CACtD,GAAMC,CAAAA,IAAI,CAAG,CACXC,kBAAkB,CAAEH,QAAQ,CAACG,kBADlB,CAEXzB,IAAI,CAAEsB,QAAQ,CAACtB,IAFJ,CAGX0B,sBAAsB,CAAEJ,QAAQ,CAACI,sBAHtB,CAIXC,SAAS,CAAEL,QAAQ,CAACK,SAJT,CAKXC,iBAAiB,CAAEN,QAAQ,CAACM,iBALjB,CAAb,CAQA,MAAO,CACLL,SAAS,CAATA,SADK,CAELM,IAAI,CAAEP,QAAQ,CAACQ,MAFV,CAGLN,IAAI,CAAJA,IAHK,CAAP,CAKD,CAdD,CAgBA,UAAaO,CAAAA,UAAb,YACE,oBAAYC,aAAZ,CAA2BC,UAA3B,CAAuC,uCA0BvCC,uBA1BuC,CA0Bb,GAAIC,CAAAA,GAAJ,EA1Ba,CAgBrC,KAAKC,MAAL,CAAc,GAAID,CAAAA,GAAJ,EAAd,CACA,KAAKE,UAAL,CAAkB,GAAIF,CAAAA,GAAJ,EAAlB,CACA,KAAKG,aAAL,CAAqB,GAAIH,CAAAA,GAAJ,EAArB,CACA,KAAKI,UAAL,CAAkB,GAAIJ,CAAAA,GAAJ,EAAlB,CACA,KAAKK,iBAAL,CAAyB,GAAIC,CAAAA,GAAJ,EAAzB,CACA,KAAKC,iBAAL,CAAyB,GAAID,CAAAA,GAAJ,EAAzB,CACA,KAAKT,aAAL,CAAqBA,aAArB,CACA9C,aAAa,CAAC+C,UAAD,CAAb,CACD,CAzBH,uEA6Bc7B,GA7Bd,CA6BmB,gBACf,GAAIuC,CAAAA,eAAe,CAAG,KAAKT,uBAAL,CAA6BU,GAA7B,CAAiCxC,GAAjC,CAAtB,CAEA,GAAI,CAACuC,eAAL,CAAsB,CACpBA,eAAe,CAAGxC,OAAO,CAACC,GAAD,OAAzB,CACA,KAAK8B,uBAAL,CAA6BW,GAA7B,CAAiCzC,GAAjC,CAAsCuC,eAAtC,EACD,CAGD,MAAOA,CAAAA,eAAe,CACnBG,IADI,CACC,SAAAC,QAAQ,CAAI,CAChB,KAAI,CAACb,uBAAL,CAA6Bc,MAA7B,CAAoC5C,GAApC,EACA,MAAO2C,CAAAA,QAAP,CACD,CAJI,EAKJE,KALI,CAKE,SAAAC,GAAG,CAAI,CACZ,KAAI,CAAChB,uBAAL,CAA6Bc,MAA7B,CAAoC5C,GAApC,EACA,KAAM8C,CAAAA,GAAN,CACD,CARI,CAAP,CASD,CA/CH,kDAiDeC,SAjDf,CAiD0B,CACtB,KAAKA,SAAL,CAAiBA,SAAjB,CACA,KAAKC,gBAAL,CAAwBD,SAAS,0BAAT,CAAoCE,IAApC,CAAyC,SAAAC,CAAC,QAAIA,CAAAA,CAAJ,EAA1C,CAAxB,CACD,CApDH,4DAsDoBC,OAtDpB,CAsD6B,oBACjBC,CAAAA,QADiB,CACSD,OADT,CACjBC,QADiB,kBACSD,OADT,CACPE,OADO,CACPA,OADO,2BACG,CADH,kBAEzB,GAAMrD,CAAAA,GAAG,CAAGL,iBAAiB,CAACyD,QAAD,CAA7B,CACA,MAAO,MAAKE,WAAL,CAAiBtD,GAAjB,EAAsB0C,IAAtB,CAA2B,SAAArC,GAAG,CAAI,IAC/BkD,CAAAA,MAD+B,CACNlD,GADM,CAC/BkD,MAD+B,CACvBC,YADuB,CACNnD,GADM,CACvBmD,YADuB,CAIvC,GAAID,MAAM,GAAK,GAAf,CAAoB,CAClB,GAAI,CACF,GAAME,CAAAA,WAAW,CAAGC,IAAI,CAACC,KAAL,CAAWH,YAAX,CAApB,CACA,GAAIC,WAAW,CAAC7D,IAAZ,GAAqBgE,SAAzB,CAAoC,CAClC,KAAM,IAAI1E,CAAAA,KAAJ,iCAAN,CACD,CAED,MAAO,UAAciE,OAAd,CAAuB,CAC5BI,MAAM,CAAEtE,kBAAkB,CAACE,OADC,CAE5B0E,OAAO,CAAEJ,WAFmB,CAAvB,CAAP,CAID,CAAC,MAAOX,GAAP,CAAY,CAEb,CACF,CAGD,GAAIS,MAAM,GAAK,GAAX,EAAkBA,MAAM,GAAK,GAAjC,CAAsC,CAEpC,GAAIH,QAAQ,cAAZ,CAA8B,CAC5B,MAAO,UAAcD,OAAd,CAAuB,CAC5BI,MAAM,CAAEtE,kBAAkB,CAACC,KADC,CAAvB,CAAP,CAGD,CAID,MAAO,CAAA,MAAI,CAAC4E,iBAAL,CACL,SAAcX,OAAd,CAAuB,CAAEC,QAAQ,YAAV,CAAyBW,QAAQ,CAAE,IAAnC,CAAvB,CADK,CAAP,CAGD,CAGD,GAAIR,MAAM,GAAK,GAAf,CAAoB,CAClB,MAAO,UAAcJ,OAAd,CAAuB,CAC5BI,MAAM,CAAEtE,kBAAkB,CAACC,KADC,CAAvB,CAAP,CAGD,CAGD,GAAImE,OAAO,CAAG,CAAd,CAAiB,CACf,MAAO,CAAA,MAAI,CAACS,iBAAL,CACL,SAAcX,OAAd,CAAuB,CAAEE,OAAO,CAAEA,OAAO,CAAG,CAArB,CAAvB,CADK,CAAP,CAGD,CAGD,MAAO,UAAcF,OAAd,CAAuB,CAC5BI,MAAM,CAAEtE,kBAAkB,CAACC,KADC,CAAvB,CAAP,CAGD,CAtDM,CAAP,CAuDD,CAhHH,0DAkHmB8E,OAlHnB,CAkH4B,iBACxB,GAAMZ,CAAAA,QAAQ,CAAGrE,QAAQ,CAACiF,OAAD,CAAzB,CACA,GAAI,KAAK7B,UAAL,CAAgB8B,GAAhB,CAAoBb,QAApB,CAAJ,CAAmC,CACjC,MAAOlD,CAAAA,OAAO,CAACC,OAAR,CAAgB,KAAKgC,UAAL,CAAgBK,GAAhB,CAAoBY,QAApB,CAAhB,CAAP,CACD,CAED,MAAO,MAAKU,iBAAL,CAAuB,CAAEV,QAAQ,CAARA,QAAF,CAAvB,EAAqCV,IAArC,CAA0C,SAAAxB,QAAQ,CAAI,CAC3D,MAAI,CAACiB,UAAL,CAAgBM,GAAhB,CAAoBW,QAApB,CAA8BlC,QAA9B,EAEA,MAAOA,CAAAA,QAAP,CACD,CAJM,CAAP,CAKD,CA7HH,oDA+HgB8C,OA/HhB,CA+HyB,CACrB,MAAOhF,CAAAA,cAAa,CAACgF,OAAD,CAApB,CACD,CAjIH,0CAoIWA,OApIX,CAoIoB,iBAChB,GAAMZ,CAAAA,QAAQ,CAAGrE,QAAQ,CAACiF,OAAD,CAAzB,CACA,GAAI,KAAKhC,MAAL,CAAYiC,GAAZ,CAAgBb,QAAhB,CAAJ,CAA+B,CAC7B,GAAMhC,CAAAA,IAAI,CAAG,KAAKY,MAAL,CAAYQ,GAAZ,CAAgBY,QAAhB,CAAb,CACA,MAAOlD,CAAAA,OAAO,CAACC,OAAR,CAAgBiB,IAAI,CAACyC,OAArB,CAAP,CACD,CAED,GAAI,KAAK5B,UAAL,CAAgBgC,GAAhB,CAAoBb,QAApB,CAAJ,CAAmC,CACjC,MAAO,MAAKnB,UAAL,CAAgBO,GAAhB,CAAoBY,QAApB,CAAP,CACD,CAED,GAAMb,CAAAA,eAAe,CAAGrC,OAAO,CAACgE,GAAR,CAAY,CAClC,KAAKC,WAAL,EADkC,CAElC,KAAKC,gBAAL,CAAsBhB,QAAtB,CAFkC,CAAZ,EAGrBV,IAHqB,CAGhB,SAAA2B,OAAO,CAAI,CACjB,GAAM3C,CAAAA,MAAM,CAAG2C,OAAO,CAAC,CAAD,CAAtB,CACA,GAAI3C,MAAM,CAAC6B,MAAP,GAAkBtE,kBAAkB,CAACC,KAAzC,CAAgD,CAC9C,MAAO,CACLqE,MAAM,CAAEtE,kBAAkB,CAACC,KADtB,CAAP,CAGD,CAED,GAAIgC,CAAAA,QAAQ,CAAGQ,MAAM,CAACmC,OAAtB,CARiB,cASsC3C,QATtC,CASTG,kBATS,WASTA,kBATS,iCASWG,iBATX,CASWA,iBATX,gCAS+B,EAT/B,uBAWjB,GAAM8C,CAAAA,WAAW,CAAG,EAApB,CAEA,GAAMC,CAAAA,qBAAqB,CAAG,MAAI,CAAC3C,aAAL,CAAmBP,kBAAnB,EAAuCqB,IAAvC,CAC5B,SAAAvB,SAAS,CAAI,CACXmD,WAAW,CAACE,SAAZ,CAAwB,GAAIC,CAAAA,IAAJ,EAAxB,CACA,GAAIC,CAAAA,aAAJ,CACA,GAAI,CAACvD,SAAL,CAAgB,CACdmD,WAAW,CAACf,MAAZ,CAAqBtE,kBAAkB,CAACC,KAAxC,CACD,CAFD,IAEO,CACLoF,WAAW,CAACf,MAAZ,CAAqBtE,kBAAkB,CAACE,OAAxC,CACA,GAAIuC,MAAM,CAACqC,QAAP,GAAoB,IAAxB,CAA8B,CAC5BO,WAAW,CAACP,QAAZ,CAAuB,IAAvB,CACD,CACD7C,QAAQ,CAAG,SAAcA,QAAd,CAAwB,CACjCI,sBAAsB,CAAE+C,OAAO,CAAC,CAAD,CAAP,CACpBA,OAAO,CAAC,CAAD,CAAP,CAAW/C,sBADS,GADS,CAAxB,CAAX,CAKAoD,aAAa,CAAGzD,eAAe,CAACC,QAAD,CAAWC,SAAX,CAA/B,CACD,CAED,MAAOuD,CAAAA,aAAP,CACD,CApB2B,CAA9B,CAuBA,GAAMC,CAAAA,uBAAuB,CAAGzE,OAAO,CAACgE,GAAR,CAC9B1C,iBAAiB,CAACoD,GAAlB,CAAsB,SAAAC,eAAe,CAAI,CAEvC,GAAI,MAAI,CAAC3C,aAAL,CAAmB+B,GAAnB,CAAuBY,eAAvB,CAAJ,CAA6C,CAC3C,GAAMpB,CAAAA,WAAW,CAAG,MAAI,CAACvB,aAAL,CAAmBM,GAAnB,CAAuBqC,eAAvB,CAApB,CACA,MAAO,CAAEA,eAAe,CAAfA,eAAF,CAAmBpB,WAAW,CAAXA,WAAnB,CAAP,CACD,CAED,MAAO,CAAA,MAAI,CAACH,WAAL,CACFxD,eADE,cAC0B+E,eAD1B,UAELnC,IAFK,CAEA,SAAArC,GAAG,CAAI,CACZ,GAAMoD,CAAAA,WAAW,CAAGC,IAAI,CAACC,KAAL,CAAWtD,GAAG,CAACmD,YAAf,CAApB,CACA,MAAO,CAAEqB,eAAe,CAAfA,eAAF,CAAmBpB,WAAW,CAAXA,WAAnB,CAAP,CACD,CALM,CAAP,CAMD,CAbD,CAD8B,EAe9Bf,IAf8B,CAezB,SAAAoC,kBAAkB,CAAI,CAC3B,GAAMC,CAAAA,qBAAqB,CAAG,EAA9B,CAEAD,kBAAkB,CAACE,OAAnB,CAA2B,cAAsC,IAAnCH,CAAAA,eAAmC,MAAnCA,eAAmC,CAAlBpB,WAAkB,MAAlBA,WAAkB,CAC/DsB,qBAAqB,CAACF,eAAD,CAArB,CAAyCpB,WAAzC,CACA,MAAI,CAACvB,aAAL,CAAmBO,GAAnB,CAAuBoC,eAAvB,CAAwCpB,WAAxC,EACD,CAHD,EAKA,MAAOsB,CAAAA,qBAAP,CACD,CAxB+B,CAAhC,CA0BA,MAAO7E,CAAAA,OAAO,CAACgE,GAAR,CAAY,CAACK,qBAAD,CAAwBI,uBAAxB,CAAZ,EAA8DjC,IAA9D,CACL,eAAyC,mCAAvCgC,aAAuC,UAAxBI,kBAAwB,UACvC,GAAIjB,CAAAA,OAAJ,CACA,GAAIa,aAAJ,CAAmB,CACjBb,OAAO,gCAAQa,aAAR,MAAuBI,kBAAkB,CAAlBA,kBAAvB,EAAP,CACAR,WAAW,CAACT,OAAZ,CAAsBA,OAAtB,CACAhF,OAAO,CAACoG,IAAR,2BAAwC,CACtC7D,IAAI,CAAEyC,OADgC,CAEtCa,aAAa,CAAEb,OAFuB,CAAxC,EAID,CAED,MAAI,CAAC7B,MAAL,CAAYS,GAAZ,CAAgBW,QAAhB,CAA0BkB,WAA1B,EAEA,MAAOT,CAAAA,OAAP,CACD,CAfI,CAAP,CAiBD,CAlFuB,CAAxB,CAoFAtB,eAAe,CACZG,IADH,CACQ,SAAAC,QAAQ,CAAI,CAChB,MAAI,CAACV,UAAL,CAAgBW,MAAhB,CAAuBQ,QAAvB,EACD,CAHH,EAIGP,KAJH,CAIS,SAAAqC,KAAK,CAAI,CACd,MAAI,CAACjD,UAAL,CAAgBW,MAAhB,CAAuBQ,QAAvB,EACA,KAAM8B,CAAAA,KAAN,CACD,CAPH,EASA,KAAKjD,UAAL,CAAgBQ,GAAhB,CAAoBW,QAApB,CAA8Bb,eAA9B,EAEA,MAAOA,CAAAA,eAAP,CACD,CA/OH,kDAkPeyB,OAlPf,CAkPwB,CACpB,GAAMZ,CAAAA,QAAQ,CAAGrE,QAAQ,CAACiF,OAAD,CAAzB,CACA,GAAI,KAAKhC,MAAL,CAAYiC,GAAZ,CAAgBb,QAAhB,CAAJ,CAA+B,CAC7B,GAAMlC,CAAAA,QAAQ,CAAG,KAAKc,MAAL,CAAYQ,GAAZ,CAAgBY,QAAhB,EAA0BS,OAA3C,CACA,MAAO3C,CAAAA,QAAP,CACD,CACD,MAAO0C,CAAAA,SAAP,CACD,CAzPH,sDA2PiBR,QA3PjB,CA2P2B,CAEvB,GAAI,CAACzC,6BAA6B,EAAlC,CAAsC,CACpC,MAAO,MAAP,CACD,CAGD,GAAI,KAAKqB,MAAL,CAAYiC,GAAZ,CAAgBb,QAAhB,CAAJ,CAA+B,CAC7B,MAAO,MAAP,CACD,CAED,MAAO,KAAP,CACD,CAvQH,0CAyQWA,QAzQX,CAyQqB,iBACjB,GAAI,CAAC,KAAK+B,cAAL,CAAoB/B,QAApB,CAAL,CAAoC,CAClC,MAAO,MAAP,CACD,CAID,GAAI,CAAC,KAAKhB,iBAAL,CAAuB6B,GAAvB,CAA2Bb,QAA3B,CAAL,CAA2C,CACzC,KAAKL,SAAL,sBAAqC,CAAEqC,QAAQ,CAAEhC,QAAZ,CAArC,EACA,KAAKhB,iBAAL,CAAuBiD,GAAvB,CAA2BjC,QAA3B,EACD,CAGD,GAAI,KAAKJ,gBAAT,CAA2B,CACzB,MAAO,MAAP,CACD,CAED,GAAMsC,CAAAA,QAAQ,CAAGvG,QAAQ,CAACqE,QAAD,CAAzB,CAGA,KAAKmC,UAAL,CAAgBD,QAAhB,EAA0B5C,IAA1B,CAA+B,UAAM,CACnC,GAAI,CAAC,MAAI,CAACJ,iBAAL,CAAuB2B,GAAvB,CAA2Bb,QAA3B,CAAL,CAA2C,CACzC,MAAI,CAACL,SAAL,0BAAyC,CAAEqC,QAAQ,CAAEhC,QAAZ,CAAzC,EACA,MAAI,CAACd,iBAAL,CAAuB+C,GAAvB,CAA2BjC,QAA3B,EACD,CACF,CALD,EAOA,MAAO,KAAP,CACD,CArSH,8CAuSaA,QAvSb,CAuSuB,CACnB,KAAM,IAAIlE,CAAAA,KAAJ,8BAAN,CACD,CAzSH,0CA2SW8E,OA3SX,CA2SoB,CAChB,KAAKwB,QAAL,CAAcxB,OAAd,EACD,CA7SH,8EA+S6BA,OA/S7B,CA+SsC,CAClC,GAAMZ,CAAAA,QAAQ,CAAGrE,QAAQ,CAACiF,OAAD,CAAzB,CACA,GAAM5C,CAAAA,IAAI,CAAG,KAAKe,UAAL,CAAgBK,GAAhB,CAAoBY,QAApB,CAAb,CACA,GAAIhC,IAAJ,CAAU,CACR,GAAMsD,CAAAA,aAAa,CAAGzD,eAAe,CAACG,IAAI,CAACyC,OAAN,CAArC,CAEA,mCACK4B,mBAAmB,CAACf,aAAa,CAACtD,IAAd,CAAmBC,kBAApB,CADxB,GAEE1B,iBAAiB,CAACyD,QAAD,CAFnB,GAID,CAPD,IAOO,CACL,MAAO,KAAP,CACD,CACF,CA5TH,sDA8TiBY,OA9TjB,CA8T0B,CACtB,GAAMZ,CAAAA,QAAQ,CAAGrE,QAAQ,CAACiF,OAAD,CAAzB,CACA,GAAM5C,CAAAA,IAAI,CAAG,KAAKY,MAAL,CAAYQ,GAAZ,CAAgBY,QAAhB,CAAb,CACA,MAAOhC,CAAAA,IAAI,EAAIA,IAAI,CAAC2C,QAAL,GAAkB,IAAjC,CACD,CAlUH,iDAoU2B,oBAAbV,CAAAA,OAAa,2DAAH,CAAG,CACvB,MAAO,MAAKC,WAAL,CAAoBxD,eAApB,6BAA+D4C,IAA/D,CACL,SAAArC,GAAG,CAAI,IACGkD,CAAAA,MADH,CAC4BlD,GAD5B,CACGkD,MADH,CACWC,YADX,CAC4BnD,GAD5B,CACWmD,YADX,CAGL,GAAIkC,CAAAA,OAAJ,CAEA,GAAInC,MAAM,GAAK,GAAX,EAAkBF,OAAO,CAAG,CAAhC,CAAmC,CAEjC,MAAO,CAAA,MAAI,CAACc,WAAL,CAAiBd,OAAO,CAAG,CAA3B,CAAP,CACD,CAGD,GAAIE,MAAM,GAAK,GAAf,CAAoB,CAClB,GAAI,CACF,GAAME,CAAAA,WAAW,CAAGC,IAAI,CAACC,KAAL,CAAWH,YAAX,CAApB,CACA,GAAIC,WAAW,CAACnC,sBAAZ,GAAuCsC,SAA3C,CAAsD,CACpD,KAAM,IAAI1E,CAAAA,KAAJ,iCAAN,CACD,CAEDwG,OAAO,CAAGjC,WAAV,CACD,CAAC,MAAOX,GAAP,CAAY,CAEb,CACF,CAED,MAAO4C,CAAAA,OAAP,CACD,CA1BI,CAAP,CA4BD,CAjWH,0BAoWA,GAAMD,CAAAA,mBAAmB,CAAG,QAAtBA,CAAAA,mBAAsB,CAAApE,kBAAkB,QAC5C,CAACsE,MAAM,CAACC,eAAP,CAAuBvE,kBAAvB,GAA8C,EAA/C,EAAmDuD,GAAnD,CACE,SAAAiB,KAAK,QAAI/F,CAAAA,eAAe,CAAG+F,KAAtB,EADP,CAD4C,EAA9C,CAKA,UAAaC,CAAAA,UAAb,6FACE,oBAAYC,aAAZ,CAA2BlE,UAA3B,CAAuC,kCACrC,GAAMD,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAAAoE,SAAS,QAC7BD,CAAAA,aAAa,CAACE,UAAd,CAAyBD,SAAzB,EACID,aAAa,CAACE,UAAd,CAAyBD,SAAzB,IACGtD,IADH,CACQtD,aADR,EAGGyD,KAHH,CAGS,iBAAM,KAAN,EAHT,CADJ,CAKI3C,OAAO,CAACC,OAAR,EANyB,EAA/B,CADqC,wBAS/ByB,aAT+B,CAShBC,UATgB,EAUtC,CAXH,qEAaauB,QAbb,CAauB,iBACnB,GAAM8C,CAAAA,WAAW,CAAGvG,iBAAiB,CAACyD,QAAD,CAArC,CACA,MAAOxE,CAAAA,cAAc,CAACsH,WAAD,CAAc,CACjCC,WAAW,YADsB,CAEjCC,EAAE,QAF+B,CAAd,CAAd,CAIJ1D,IAJI,CAIC,iBAGJ,CAAA,MAAI,CAAC0B,gBAAL,CAAsBhB,QAAtB,CAHI,EAJD,EASJV,IATI,CASC,SAAAhB,MAAM,CAAI,CACd,GAAIA,MAAM,CAAC6B,MAAP,GAAkBtE,kBAAkB,CAACE,OAAzC,CAAkD,CAChD,MAAOe,CAAAA,OAAO,CAACC,OAAR,EAAP,CACD,CACD,GAAMe,CAAAA,QAAQ,CAAGQ,MAAM,CAACmC,OAAxB,CACA,GAAMmC,CAAAA,SAAS,CAAG9E,QAAQ,CAACG,kBAA3B,CACA,GAAMgF,CAAAA,aAAa,CAAGZ,mBAAmB,CAACO,SAAD,CAAzC,CACA,MAAO9F,CAAAA,OAAO,CAACgE,GAAR,CAAYmC,aAAa,CAACzB,GAAd,CAAkBhG,cAAlB,CAAZ,EAA+C8D,IAA/C,CACL,iBAAMxB,CAAAA,QAAN,EADK,CAAP,CAGD,CAnBI,CAAP,CAoBD,CAnCH,0DAqCmB8C,OArCnB,CAqC4B,CACxB,MAAO,+EAAuBA,OAAvB,EAAgCtB,IAAhC,CAAqC,SAAA4D,IAAI,CAAI,CAClD,GAAIA,IAAI,CAACvC,QAAT,CAAmB,CAGjB,MAAOhE,CAAAA,OAAO,CAACiE,OAAD,QAAP,CAAyBtB,IAAzB,CAA8B,SAAArC,GAAG,CAAI,CAC1C,GAAIA,GAAG,CAACkD,MAAJ,GAAe,GAAnB,CAAwB,CAItB,MAAO,CACLA,MAAM,CAAEtE,kBAAkB,CAACC,KADtB,CAAP,CAGD,CAID,MAAOoH,CAAAA,IAAP,CACD,CAbM,CAAP,CAcD,CACD,MAAOA,CAAAA,IAAP,CACD,CApBM,CAAP,CAqBD,CA3DH,wBAAgC3E,UAAhC,EA8DA,GAAI4E,CAAAA,QAAJ,CAEA,MAAO,IAAMC,CAAAA,SAAS,CAAG,QAAZA,CAAAA,SAAY,CAAAC,OAAO,CAAI,CAClCF,QAAQ,CAAGE,OAAX,CACD,CAFM,CAIP,MAAO,IAAMC,CAAAA,YAAY,CAAG,CAI1BC,uBAAuB,CAAE,iCAAA3C,OAAO,CAAI,CAClC4C,OAAO,CAACC,IAAR,yEAGA,MAAON,CAAAA,QAAQ,CAACO,CAAT,CAAWtB,QAAX,CAAoBxB,OAApB,CAAP,CACD,CATyB,CAU1B+C,2BAA2B,CAAE,qCAAA/C,OAAO,CAAI,CACtC4C,OAAO,CAACC,IAAR,iFAGA,MAAON,CAAAA,QAAQ,CAACO,CAAT,CAAWE,YAAX,CAAwBhD,OAAxB,CAAP,CACD,CAfyB,CAgB1BiD,OAAO,CAAE,iBAAAjD,OAAO,QAAIuC,CAAAA,QAAQ,CAACW,QAAT,CAAkBlD,OAAlB,CAAJ,EAhBU,CAmB1BmD,0BAA0B,CAAE,oCAAAnD,OAAO,QACjCuC,CAAAA,QAAQ,CAACY,0BAAT,CAAoCnD,OAApC,CADiC,EAnBT,CAqB1BwB,QAAQ,CAAE,kBAAAxB,OAAO,QAAIuC,CAAAA,QAAQ,CAACf,QAAT,CAAkBxB,OAAlB,CAAJ,EArBS,CAsB1BgD,YAAY,CAAE,sBAAAhD,OAAO,QAAIuC,CAAAA,QAAQ,CAACS,YAAT,CAAsBhD,OAAtB,CAAJ,EAtBK,CAuB1BkD,QAAQ,CAAE,kBAAAlD,OAAO,QAAIuC,CAAAA,QAAQ,CAACW,QAAT,CAAkBlD,OAAlB,CAAJ,EAvBS,CAwB1BoD,cAAc,CAAE,wBAAApD,OAAO,QAAIuC,CAAAA,QAAQ,CAACa,cAAT,CAAwBpD,OAAxB,CAAJ,EAxBG,CAyB1BqD,QAAQ,CAAE,kBAAArD,OAAO,QAAIuC,CAAAA,QAAQ,CAACc,QAAT,CAAkBrD,OAAlB,CAAJ,EAzBS,CA0B1BG,WAAW,CAAE,6BAAMoC,CAAAA,QAAQ,CAACpC,WAAT,EAAN,EA1Ba,CAArB,CA6BP,cAAeuC,CAAAA,YAAf","sourcesContent":["import prefetchHelper from \"./prefetch\"\nimport emitter from \"./emitter\"\nimport { setMatchPaths, findPath, findMatchPath } from \"./find-path\"\n\n/**\n * Available resource loading statuses\n */\nexport const PageResourceStatus = {\n  /**\n   * At least one of critical resources failed to load\n   */\n  Error: `error`,\n  /**\n   * Resources loaded successfully\n   */\n  Success: `success`,\n}\n\nconst preferDefault = m => (m && m.default) || m\n\nconst stripSurroundingSlashes = s => {\n  s = s[0] === `/` ? s.slice(1) : s\n  s = s.endsWith(`/`) ? s.slice(0, -1) : s\n  return s\n}\n\nconst createPageDataUrl = path => {\n  const fixedPath = path === `/` ? `index` : stripSurroundingSlashes(path)\n  return `${__PATH_PREFIX__}/page-data/${fixedPath}/page-data.json`\n}\n\nfunction doFetch(url, method = `GET`) {\n  return new Promise((resolve, reject) => {\n    const req = new XMLHttpRequest()\n    req.open(method, url, true)\n    req.onreadystatechange = () => {\n      if (req.readyState == 4) {\n        resolve(req)\n      }\n    }\n    req.send(null)\n  })\n}\n\nconst doesConnectionSupportPrefetch = () => {\n  if (\n    `connection` in navigator &&\n    typeof navigator.connection !== `undefined`\n  ) {\n    if ((navigator.connection.effectiveType || ``).includes(`2g`)) {\n      return false\n    }\n    if (navigator.connection.saveData) {\n      return false\n    }\n  }\n  return true\n}\n\nconst toPageResources = (pageData, component = null) => {\n  const page = {\n    componentChunkName: pageData.componentChunkName,\n    path: pageData.path,\n    webpackCompilationHash: pageData.webpackCompilationHash,\n    matchPath: pageData.matchPath,\n    staticQueryHashes: pageData.staticQueryHashes,\n  }\n\n  return {\n    component,\n    json: pageData.result,\n    page,\n  }\n}\n\nexport class BaseLoader {\n  constructor(loadComponent, matchPaths) {\n    // Map of pagePath -> Page. Where Page is an object with: {\n    //   status: PageResourceStatus.Success || PageResourceStatus.Error,\n    //   payload: PageResources, // undefined if PageResourceStatus.Error\n    // }\n    // PageResources is {\n    //   component,\n    //   json: pageData.result,\n    //   page: {\n    //     componentChunkName,\n    //     path,\n    //     webpackCompilationHash,\n    //     staticQueryHashes\n    //   },\n    //   staticQueryResults\n    // }\n    this.pageDb = new Map()\n    this.inFlightDb = new Map()\n    this.staticQueryDb = new Map()\n    this.pageDataDb = new Map()\n    this.prefetchTriggered = new Set()\n    this.prefetchCompleted = new Set()\n    this.loadComponent = loadComponent\n    setMatchPaths(matchPaths)\n  }\n\n  inFlightNetworkRequests = new Map()\n\n  memoizedGet(url) {\n    let inFlightPromise = this.inFlightNetworkRequests.get(url)\n\n    if (!inFlightPromise) {\n      inFlightPromise = doFetch(url, `GET`)\n      this.inFlightNetworkRequests.set(url, inFlightPromise)\n    }\n\n    // Prefer duplication with then + catch over .finally to prevent problems in ie11 + firefox\n    return inFlightPromise\n      .then(response => {\n        this.inFlightNetworkRequests.delete(url)\n        return response\n      })\n      .catch(err => {\n        this.inFlightNetworkRequests.delete(url)\n        throw err\n      })\n  }\n\n  setApiRunner(apiRunner) {\n    this.apiRunner = apiRunner\n    this.prefetchDisabled = apiRunner(`disableCorePrefetching`).some(a => a)\n  }\n\n  fetchPageDataJson(loadObj) {\n    const { pagePath, retries = 0 } = loadObj\n    const url = createPageDataUrl(pagePath)\n    return this.memoizedGet(url).then(req => {\n      const { status, responseText } = req\n\n      // Handle 200\n      if (status === 200) {\n        try {\n          const jsonPayload = JSON.parse(responseText)\n          if (jsonPayload.path === undefined) {\n            throw new Error(`not a valid pageData response`)\n          }\n\n          return Object.assign(loadObj, {\n            status: PageResourceStatus.Success,\n            payload: jsonPayload,\n          })\n        } catch (err) {\n          // continue regardless of error\n        }\n      }\n\n      // Handle 404\n      if (status === 404 || status === 200) {\n        // If the request was for a 404 page and it doesn't exist, we're done\n        if (pagePath === `/404.html`) {\n          return Object.assign(loadObj, {\n            status: PageResourceStatus.Error,\n          })\n        }\n\n        // Need some code here to cache the 404 request. In case\n        // multiple loadPageDataJsons result in 404s\n        return this.fetchPageDataJson(\n          Object.assign(loadObj, { pagePath: `/404.html`, notFound: true })\n        )\n      }\n\n      // handle 500 response (Unrecoverable)\n      if (status === 500) {\n        return Object.assign(loadObj, {\n          status: PageResourceStatus.Error,\n        })\n      }\n\n      // Handle everything else, including status === 0, and 503s. Should retry\n      if (retries < 3) {\n        return this.fetchPageDataJson(\n          Object.assign(loadObj, { retries: retries + 1 })\n        )\n      }\n\n      // Retried 3 times already, result is an error.\n      return Object.assign(loadObj, {\n        status: PageResourceStatus.Error,\n      })\n    })\n  }\n\n  loadPageDataJson(rawPath) {\n    const pagePath = findPath(rawPath)\n    if (this.pageDataDb.has(pagePath)) {\n      return Promise.resolve(this.pageDataDb.get(pagePath))\n    }\n\n    return this.fetchPageDataJson({ pagePath }).then(pageData => {\n      this.pageDataDb.set(pagePath, pageData)\n\n      return pageData\n    })\n  }\n\n  findMatchPath(rawPath) {\n    return findMatchPath(rawPath)\n  }\n\n  // TODO check all uses of this and whether they use undefined for page resources not exist\n  loadPage(rawPath) {\n    const pagePath = findPath(rawPath)\n    if (this.pageDb.has(pagePath)) {\n      const page = this.pageDb.get(pagePath)\n      return Promise.resolve(page.payload)\n    }\n\n    if (this.inFlightDb.has(pagePath)) {\n      return this.inFlightDb.get(pagePath)\n    }\n\n    const inFlightPromise = Promise.all([\n      this.loadAppData(),\n      this.loadPageDataJson(pagePath),\n    ]).then(allData => {\n      const result = allData[1]\n      if (result.status === PageResourceStatus.Error) {\n        return {\n          status: PageResourceStatus.Error,\n        }\n      }\n\n      let pageData = result.payload\n      const { componentChunkName, staticQueryHashes = [] } = pageData\n\n      const finalResult = {}\n\n      const componentChunkPromise = this.loadComponent(componentChunkName).then(\n        component => {\n          finalResult.createdAt = new Date()\n          let pageResources\n          if (!component) {\n            finalResult.status = PageResourceStatus.Error\n          } else {\n            finalResult.status = PageResourceStatus.Success\n            if (result.notFound === true) {\n              finalResult.notFound = true\n            }\n            pageData = Object.assign(pageData, {\n              webpackCompilationHash: allData[0]\n                ? allData[0].webpackCompilationHash\n                : ``,\n            })\n            pageResources = toPageResources(pageData, component)\n          }\n          // undefined if final result is an error\n          return pageResources\n        }\n      )\n\n      const staticQueryBatchPromise = Promise.all(\n        staticQueryHashes.map(staticQueryHash => {\n          // Check for cache in case this static query result has already been loaded\n          if (this.staticQueryDb.has(staticQueryHash)) {\n            const jsonPayload = this.staticQueryDb.get(staticQueryHash)\n            return { staticQueryHash, jsonPayload }\n          }\n\n          return this.memoizedGet(\n            `${__PATH_PREFIX__}/static/d/${staticQueryHash}.json`\n          ).then(req => {\n            const jsonPayload = JSON.parse(req.responseText)\n            return { staticQueryHash, jsonPayload }\n          })\n        })\n      ).then(staticQueryResults => {\n        const staticQueryResultsMap = {}\n\n        staticQueryResults.forEach(({ staticQueryHash, jsonPayload }) => {\n          staticQueryResultsMap[staticQueryHash] = jsonPayload\n          this.staticQueryDb.set(staticQueryHash, jsonPayload)\n        })\n\n        return staticQueryResultsMap\n      })\n\n      return Promise.all([componentChunkPromise, staticQueryBatchPromise]).then(\n        ([pageResources, staticQueryResults]) => {\n          let payload\n          if (pageResources) {\n            payload = { ...pageResources, staticQueryResults }\n            finalResult.payload = payload\n            emitter.emit(`onPostLoadPageResources`, {\n              page: payload,\n              pageResources: payload,\n            })\n          }\n\n          this.pageDb.set(pagePath, finalResult)\n\n          return payload\n        }\n      )\n    })\n\n    inFlightPromise\n      .then(response => {\n        this.inFlightDb.delete(pagePath)\n      })\n      .catch(error => {\n        this.inFlightDb.delete(pagePath)\n        throw error\n      })\n\n    this.inFlightDb.set(pagePath, inFlightPromise)\n\n    return inFlightPromise\n  }\n\n  // returns undefined if loading page ran into errors\n  loadPageSync(rawPath) {\n    const pagePath = findPath(rawPath)\n    if (this.pageDb.has(pagePath)) {\n      const pageData = this.pageDb.get(pagePath).payload\n      return pageData\n    }\n    return undefined\n  }\n\n  shouldPrefetch(pagePath) {\n    // Skip prefetching if we know user is on slow or constrained connection\n    if (!doesConnectionSupportPrefetch()) {\n      return false\n    }\n\n    // Check if the page exists.\n    if (this.pageDb.has(pagePath)) {\n      return false\n    }\n\n    return true\n  }\n\n  prefetch(pagePath) {\n    if (!this.shouldPrefetch(pagePath)) {\n      return false\n    }\n\n    // Tell plugins with custom prefetching logic that they should start\n    // prefetching this path.\n    if (!this.prefetchTriggered.has(pagePath)) {\n      this.apiRunner(`onPrefetchPathname`, { pathname: pagePath })\n      this.prefetchTriggered.add(pagePath)\n    }\n\n    // If a plugin has disabled core prefetching, stop now.\n    if (this.prefetchDisabled) {\n      return false\n    }\n\n    const realPath = findPath(pagePath)\n    // Todo make doPrefetch logic cacheable\n    // eslint-disable-next-line consistent-return\n    this.doPrefetch(realPath).then(() => {\n      if (!this.prefetchCompleted.has(pagePath)) {\n        this.apiRunner(`onPostPrefetchPathname`, { pathname: pagePath })\n        this.prefetchCompleted.add(pagePath)\n      }\n    })\n\n    return true\n  }\n\n  doPrefetch(pagePath) {\n    throw new Error(`doPrefetch not implemented`)\n  }\n\n  hovering(rawPath) {\n    this.loadPage(rawPath)\n  }\n\n  getResourceURLsForPathname(rawPath) {\n    const pagePath = findPath(rawPath)\n    const page = this.pageDataDb.get(pagePath)\n    if (page) {\n      const pageResources = toPageResources(page.payload)\n\n      return [\n        ...createComponentUrls(pageResources.page.componentChunkName),\n        createPageDataUrl(pagePath),\n      ]\n    } else {\n      return null\n    }\n  }\n\n  isPageNotFound(rawPath) {\n    const pagePath = findPath(rawPath)\n    const page = this.pageDb.get(pagePath)\n    return page && page.notFound === true\n  }\n\n  loadAppData(retries = 0) {\n    return this.memoizedGet(`${__PATH_PREFIX__}/page-data/app-data.json`).then(\n      req => {\n        const { status, responseText } = req\n\n        let appData\n\n        if (status !== 200 && retries < 3) {\n          // Retry 3 times incase of non-200 responses\n          return this.loadAppData(retries + 1)\n        }\n\n        // Handle 200\n        if (status === 200) {\n          try {\n            const jsonPayload = JSON.parse(responseText)\n            if (jsonPayload.webpackCompilationHash === undefined) {\n              throw new Error(`not a valid app-data response`)\n            }\n\n            appData = jsonPayload\n          } catch (err) {\n            // continue regardless of error\n          }\n        }\n\n        return appData\n      }\n    )\n  }\n}\n\nconst createComponentUrls = componentChunkName =>\n  (window.___chunkMapping[componentChunkName] || []).map(\n    chunk => __PATH_PREFIX__ + chunk\n  )\n\nexport class ProdLoader extends BaseLoader {\n  constructor(asyncRequires, matchPaths) {\n    const loadComponent = chunkName =>\n      asyncRequires.components[chunkName]\n        ? asyncRequires.components[chunkName]()\n            .then(preferDefault)\n            // loader will handle the case when component is null\n            .catch(() => null)\n        : Promise.resolve()\n\n    super(loadComponent, matchPaths)\n  }\n\n  doPrefetch(pagePath) {\n    const pageDataUrl = createPageDataUrl(pagePath)\n    return prefetchHelper(pageDataUrl, {\n      crossOrigin: `anonymous`,\n      as: `fetch`,\n    })\n      .then(() =>\n        // This was just prefetched, so will return a response from\n        // the cache instead of making another request to the server\n        this.loadPageDataJson(pagePath)\n      )\n      .then(result => {\n        if (result.status !== PageResourceStatus.Success) {\n          return Promise.resolve()\n        }\n        const pageData = result.payload\n        const chunkName = pageData.componentChunkName\n        const componentUrls = createComponentUrls(chunkName)\n        return Promise.all(componentUrls.map(prefetchHelper)).then(\n          () => pageData\n        )\n      })\n  }\n\n  loadPageDataJson(rawPath) {\n    return super.loadPageDataJson(rawPath).then(data => {\n      if (data.notFound) {\n        // check if html file exist using HEAD request:\n        // if it does we should navigate to it instead of showing 404\n        return doFetch(rawPath, `HEAD`).then(req => {\n          if (req.status === 200) {\n            // page (.html file) actually exist (or we asked for 404 )\n            // returning page resources status as errored to trigger\n            // regular browser navigation to given page\n            return {\n              status: PageResourceStatus.Error,\n            }\n          }\n\n          // if HEAD request wasn't 200, return notFound result\n          // and show 404 page\n          return data\n        })\n      }\n      return data\n    })\n  }\n}\n\nlet instance\n\nexport const setLoader = _loader => {\n  instance = _loader\n}\n\nexport const publicLoader = {\n  // Deprecated methods. As far as we're aware, these are only used by\n  // core gatsby and the offline plugin, however there's a very small\n  // chance they're called by others.\n  getResourcesForPathname: rawPath => {\n    console.warn(\n      `Warning: getResourcesForPathname is deprecated. Use loadPage instead`\n    )\n    return instance.i.loadPage(rawPath)\n  },\n  getResourcesForPathnameSync: rawPath => {\n    console.warn(\n      `Warning: getResourcesForPathnameSync is deprecated. Use loadPageSync instead`\n    )\n    return instance.i.loadPageSync(rawPath)\n  },\n  enqueue: rawPath => instance.prefetch(rawPath),\n\n  // Real methods\n  getResourceURLsForPathname: rawPath =>\n    instance.getResourceURLsForPathname(rawPath),\n  loadPage: rawPath => instance.loadPage(rawPath),\n  loadPageSync: rawPath => instance.loadPageSync(rawPath),\n  prefetch: rawPath => instance.prefetch(rawPath),\n  isPageNotFound: rawPath => instance.isPageNotFound(rawPath),\n  hovering: rawPath => instance.hovering(rawPath),\n  loadAppData: () => instance.loadAppData(),\n}\n\nexport default publicLoader\n"]},"metadata":{},"sourceType":"module"}